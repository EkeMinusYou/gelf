# AIエージェント `geminielf` 開発計画

## 1. プロジェクトの目的

ソフトウェアエンジニアの開発ワークフローを効率化するため、コード解析、コード生成、およびコマンド実行機能をTUIチャットインターフェースを通じて提供するAIエージェントを開発します。

## 2. 主要機能

*   **TUIチャットインターフェース**: `ink` を使用したインタラクティブなチャット形式でのユーザーとの対話。
*   **コード解析**: LSPクライアントからの情報（シンボル情報、型情報、診断結果など）を活用したコードの理解と問題点の特定。
*   **コード生成**: Geminiモデルとコード解析結果に基づいた、文脈に即したコードの生成。
*   **コマンド実行**: TUIを通じて、プロジェクト固有のコマンド（ビルド、テスト、リンターなど）を実行し、結果を表示。
*   **設定管理**: TOML形式の設定ファイル（メイン設定およびLSPクライアント設定）の読み込み・管理。

## 3. 技術スタック

*   **言語**: TypeScript
*   **CLI/TUI**: `ink` (Reactベース)
*   **LLM連携**: Geminiモデル (Node.jsクライアントライブラリ)
*   **コード解析**: LSPクライアントライブラリ, 必要に応じて正規表現/テキスト処理
*   **ファイルシステム操作**: Node.js `fs` モジュール, `fs-extra` など
*   **コマンド実行**: Node.js `child_process` モジュールなど
*   **TOMLパース**: `@iarna/toml` などのTOMLパーサーライブラリ

## 4. アーキテクチャ

```mermaid
graph TD
    A[ユーザー] --> B(TUIチャットインターフェース - ink);
    B --> H(対話管理モジュール);
    H --> C(設定管理モジュール);
    C --> J(設定ファイル - TOML); %% メイン設定とLSP設定を含む
    H --> D(ファイルシステム操作モジュール);
    H --> E(コード解析モジュール);
    E --> G(LSPクライアント);
    G --> E;
    E --> F(コード生成モジュール);
    F --> D;
    H --> I(コマンド実行モジュール);
    I --> B;
    C --> G; %% 設定管理モジュールがLSPクライアントに設定を渡す
```

## 5. 開発ステップ

以下のステップで開発を進めます。

1.  **ステップ1: inkを用いたTUIチャットの基盤実装**
    *   新しいTypeScriptプロジェクトを作成し、必要な依存関係（`typescript`, `react`, `ink`, Gemini Node.jsクライアントライブラリなど）を追加します。
    *   `ink` を使用して、チャット表示エリアと入力エリアを持つ基本的なTUIレイアウトを実装します。
    *   ユーザーがTUIの入力エリアからメッセージを入力し、LLM（Gemini）に送信する機能を実装します。
    *   LLMからの応答を受け取り、TUIのチャット表示エリアに表示する機能を実装します。
    *   簡単なチャット履歴をTUI上に表示し、対話の文脈をLLMに渡せるようにします。
    *   Gemini APIキーの設定方法（環境変数など）を定義します。
    *   この段階では、設定管理、ファイルシステム操作、コード解析、LSP連携、コマンド実行モジュールは含めず、`ink` を用いたチャットのUIとLLM連携の最小限の機能に絞ります。
2.  **ステップ2以降**:
    *   ステップ1で実装したTUIチャットの基盤を拡張し、当初計画していた他の機能（設定管理、ファイルシステム操作、コード解析、LSP連携、コマンド実行、コード生成の強化など）を段階的に実装していきます。
    *   エラーハンドリング、ロギング、テスト、ドキュメンテーションを進めます。

## 6. 今後の検討事項

*   AST解析の導入によるコード理解の深化。
*   他のLLMやコード生成モデルのサポート。
*   言語ごとの解析・生成ロジックをプラグインとして容易に追加できる拡張機構。
*   より高度な対話理解のための自然言語処理技術の導入。
*   パフォーマンス最適化と大規模プロジェクトへの対応。